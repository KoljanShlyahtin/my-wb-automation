/**
 * === –°–ö–†–ò–ü–¢ –ê–í–¢–û–ú–ê–¢–ò–ó–ê–¶–ò–ò –¢–ï–ú–ü–ï–†–ê–¢–£–†–´ –¶–í–ï–¢–ê –°–í–ï–¢–ê –ö–û–†–†–ò–î–û–†–ê ===
 * –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:
 * - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑–º–µ–Ω—è–µ—Ç —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É —Ü–≤–µ—Ç–∞ —Å–≤–µ—Ç–∞ –≤ –∫–æ—Ä–∏–¥–æ—Ä–µ (wb-led_56) –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é (—É—Ç—Ä–æ, –≤–µ—á–µ—Ä, –Ω–æ—á—å).
 * - –ü–ª–∞–≤–Ω–æ –∏–∑–º–µ–Ω—è–µ—Ç —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É —Ü–≤–µ—Ç–∞ (—à–∞–≥ 5% –∫–∞–∂–¥—ã–µ 4 —Å–µ–∫—É–Ω–¥—ã).
 * - –ü—Ä–∏ —Ä—É—á–Ω–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã —Ü–≤–µ—Ç–∞ –æ—Ç–∫–ª—é—á–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏–∫—É –Ω–∞ 30 –º–∏–Ω—É—Ç.
 * - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–µ–π —á–µ—Ä–µ–∑ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ 'auto_corridor_temp_control'.
 * - –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏.
 */

// === –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏ (—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏) ===
var ps_temp = new PersistentStorage("corridor_auto_temp", { global: true });

// === –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è ===
// –ì–ª–æ–±–∞–ª—å–Ω—ã–π —Ñ–ª–∞–≥, —É–∫–∞–∑—ã–≤–∞—é—â–∏–π, –∞–∫—Ç–∏–≤–Ω–æ –ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
global.__CORRIDOR_AUTO_TEMP_ENABLED = true;
// ID —Ç–∞–π–º–µ—Ä–∞, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è –æ—Ç–∫–ª—é—á–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏–∫–∏
global.__CORRIDOR_AUTO_TEMP_TIMER_ID = null;
// –§–ª–∞–≥ –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞ —Ñ—É–Ω–∫—Ü–∏–∏ disableCorridorAutoTemp
global.__CORRIDOR_AUTO_TEMP_LOCK = false;
// --- –ù–û–í–û–ï: –§–ª–∞–≥, —É–∫–∞–∑—ã–≤–∞—é—â–∏–π, —á—Ç–æ —Ç–∞–π–º–µ—Ä —Ä—É—á–Ω–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∞–∫—Ç–∏–≤–µ–Ω ---
global.__MANUAL_CHANGE_TIMER_ACTIVE_TEMP = false; // <-- –î–æ–±–∞–≤–ª–µ–Ω–æ
// --- –ù–û–í–û–ï: ID —Ç–∞–π–º–µ—Ä–∞ —Ä—É—á–Ω–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è ---
global.__MANUAL_CHANGE_TIMEOUT_ID_TEMP = null; // <-- –î–æ–±–∞–≤–ª–µ–Ω–æ
// --- –ù–û–í–û–ï: –§–ª–∞–≥ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–ª–∞–≤–Ω–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞ ---
global.__GRADUAL_TRANSITION_ACTIVE_TEMP = false; // <-- –î–æ–±–∞–≤–ª–µ–Ω–æ
// --- –ù–û–í–û–ï: ID –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ –¥–ª—è –ø–ª–∞–≤–Ω–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞ ---
global.__GRADUAL_TRANSITION_INTERVAL_ID_TEMP = null; // <-- –î–æ–±–∞–≤–ª–µ–Ω–æ
// –û–∂–∏–¥–∞–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã –≤ –º–æ–º–µ–Ω—Ç –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏–∫–∏
global.__CORRIDOR_EXPECTED_CCT1_TEMP = null;
global.__CORRIDOR_EXPECTED_CCT2_TEMP = null;

// === –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–ª–∞–≤–Ω–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã ===
function stopGradualTemperatureTransition() {
    if (global.__GRADUAL_TRANSITION_INTERVAL_ID_TEMP) {
        clearInterval(global.__GRADUAL_TRANSITION_INTERVAL_ID_TEMP);
        global.__GRADUAL_TRANSITION_INTERVAL_ID_TEMP = null;
        global.__GRADUAL_TRANSITION_ACTIVE_TEMP = false;
        log("üîÑ –ò–Ω—Ç–µ—Ä–≤–∞–ª –ø–ª–∞–≤–Ω–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω.");
    }
}

// === –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è *–ø–ª–∞–≤–Ω–æ–≥–æ* –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã (—Ç–æ–ª—å–∫–æ –¥–ª—è –∫–æ—Ä–∏–¥–æ—Ä–∞) ===
function setGradualTemperatureChannels(targetValue) {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∑–∞–ø—É—â–µ–Ω –ª–∏ —É–∂–µ –ø–ª–∞–≤–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥
    if (global.__GRADUAL_TRANSITION_ACTIVE_TEMP) {
        log("‚ö†Ô∏è –ü–ª–∞–≤–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã —É–∂–µ –∞–∫—Ç–∏–≤–µ–Ω. –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π.");
        stopGradualTemperatureTransition();
    }

    // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã —Å –ø–µ—Ä–≤–æ–≥–æ –∫–∞–Ω–∞–ª–∞ –∫–æ—Ä–∏–¥–æ—Ä–∞
    var firstCorridorChannel = "wb-led_56/CCT1 Temperature"; // –ë–µ—Ä—ë–º –∑–∞ –æ—Å–Ω–æ–≤—É –ø–µ—Ä–≤—ã–π –∫–∞–Ω–∞–ª
    if (dev[firstCorridorChannel] === undefined) {
        log("‚ùå setGradualTemperatureChannels: –∫–∞–Ω–∞–ª {} –Ω–µ –Ω–∞–π–¥–µ–Ω. –ü—Ä–∏–º–µ–Ω—è–µ–º –æ–±—ã—á–Ω—É—é —É—Å—Ç–∞–Ω–æ–≤–∫—É —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã.", firstCorridorChannel);
        // –ü—Ä–∏–º–µ–Ω—è–µ–º –æ–±—ã—á–Ω—É—é —É—Å—Ç–∞–Ω–æ–≤–∫—É –¥–ª—è –æ–±–æ–∏—Ö –∫–∞–Ω–∞–ª–æ–≤
        dev["wb-led_56/CCT1 Temperature"] = targetValue;
        dev["wb-led_56/CCT2 Temperature"] = targetValue;
        return;
    }

    var currentTemp = dev[firstCorridorChannel];
    log("üîÑ setGradualTemperatureChannels: —Ç–µ–∫—É—â–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –Ω–∞ {}: {}", firstCorridorChannel, currentTemp);

    if (currentTemp === targetValue) {
        log("‚ÑπÔ∏è setGradualTemperatureChannels: —Ç–µ–∫—É—â–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ ({}) —É–∂–µ —Ä–∞–≤–Ω–∞ —Ü–µ–ª–µ–≤–æ–π ({}). –ü–ª–∞–≤–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è.", currentTemp, targetValue);
        return;
    }

    // –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–ª–∞–≤–Ω–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞
    var stepSize = 5; // –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã –Ω–∞ 5% –∑–∞ —à–∞–≥ (–º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è –ø–æ–¥—Å—Ç—Ä–æ–π–∫–∞)
    var stepIntervalMs = 3000; // –ò–Ω—Ç–µ—Ä–≤–∞–ª –º–µ–∂–¥—É —à–∞–≥–∞–º–∏ –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö (5 —Å–µ–∫—É–Ω–¥)

    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
    var isIncreasing = targetValue > currentTemp;
    var currentValue = currentTemp;

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–¥–Ω–æ–≥–æ —à–∞–≥–∞
    function performStep() {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å –ª–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏–∫–∏ –∏–ª–∏ —Ä—É—á–Ω–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤–æ –≤—Ä–µ–º—è –ø–µ—Ä–µ—Ö–æ–¥–∞
        if (!global.__CORRIDOR_AUTO_TEMP_ENABLED || global.__AUTO_MODE_PAUSED_BY_MANUAL_CHANGE_TEMP) { // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ñ–ª–∞–≥ –¥–ª—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã
            log("‚ö†Ô∏è –ê–≤—Ç–æ–º–∞—Ç–∏–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∞ –∏–ª–∏ —Ä—É—á–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ –≤–æ –≤—Ä–µ–º—è –ø–ª–∞–≤–Ω–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã. –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–µ—Ä–µ—Ö–æ–¥.");
            stopGradualTemperatureTransition();
            return;
        }

        var nextValue;
        if (isIncreasing) {
            nextValue = Math.min(currentValue + stepSize, targetValue);
        } else {
            nextValue = Math.max(currentValue - stepSize, targetValue);
        }

        if (nextValue !== currentValue) {
            log("üîÑ –ü–ª–∞–≤–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã: —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º {} –Ω–∞ –∫–∞–Ω–∞–ª—ã –∫–æ—Ä–∏–¥–æ—Ä–∞.", nextValue);
            // –ü—Ä–∏–º–µ–Ω—è–µ–º –∫ –æ–±–æ–∏–º –∫–∞–Ω–∞–ª–∞–º
            dev["wb-led_56/CCT1 Temperature"] = nextValue;
            dev["wb-led_56/CCT2 Temperature"] = nextValue;
            currentValue = nextValue; // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ —à–∞–≥–∞
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –¥–æ—Å—Ç–∏–≥–ª–∏ –ª–∏ —Ü–µ–ª–∏
        if (nextValue === targetValue) {
            log("‚úÖ –ü–ª–∞–≤–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã –∑–∞–≤–µ—Ä—à—ë–Ω. –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –Ω–∞ {}.", targetValue);
            stopGradualTemperatureTransition(); // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–Ω—Ç–µ—Ä–≤–∞–ª
        }
    }

    // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–Ω—Ç–µ—Ä–≤–∞–ª –¥–ª—è –ø–ª–∞–≤–Ω–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞
    global.__GRADUAL_TRANSITION_ACTIVE_TEMP = true;
    global.__GRADUAL_TRANSITION_INTERVAL_ID_TEMP = setInterval(performStep, stepIntervalMs);
    log("üîÑ –ó–∞–ø—É—â–µ–Ω –ø–ª–∞–≤–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã –æ—Ç {} –∫ {} —Å —à–∞–≥–æ–º {}% –∫–∞–∂–¥—ã–µ {} –º—Å.", currentTemp, targetValue, stepSize, stepIntervalMs);
}


// === –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–±—Ä–æ—Å–∞ —Ç–∞–π–º–µ—Ä–∞ (–µ—Å–ª–∏ –æ–Ω –∞–∫—Ç–∏–≤–µ–Ω) ===
function clearManualChangeTimeoutTemp() {
    if (global.__MANUAL_CHANGE_TIMEOUT_ID_TEMP) {
        clearTimeout(global.__MANUAL_CHANGE_TIMEOUT_ID_TEMP);
        global.__MANUAL_CHANGE_TIMEOUT_ID_TEMP = null;
        global.__MANUAL_CHANGE_TIMER_ACTIVE_TEMP = false; // <-- –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –≤ false
        log("‚è∞ –¢–∞–π–º–µ—Ä —Ä—É—á–Ω–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã –∫–æ—Ä–∏–¥–æ—Ä–∞ —Å–±—Ä–æ—à–µ–Ω.");
    }
}

// === –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–∫–ª—é—á–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–æ–±–Ω–æ–≤–ª—ë–Ω–Ω–∞—è) ===
function disableCorridorAutoTemp(timeoutMinutes) {
    // –ë–ª–æ–∫–∏—Ä—É–µ–º –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –≤—Ö–æ–¥ –≤ —Ñ—É–Ω–∫—Ü–∏—é
    if (global.__CORRIDOR_AUTO_TEMP_LOCK) {
        log("üîí –§—É–Ω–∫—Ü–∏—è disableCorridorAutoTemp —É–∂–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –≤—ã–∑–æ–≤.");
        return;
    }
    global.__CORRIDOR_AUTO_TEMP_LOCK = true;

    try {
        // –°–Ω–∞—á–∞–ª–∞ —Å–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—Ç–∞—Ä—ã–π —Ç–∞–π–º–µ—Ä, –µ—Å–ª–∏ –æ–Ω –±—ã–ª
        clearManualChangeTimeoutTemp(); // –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–æ–≤—É—é —Ñ—É–Ω–∫—Ü–∏—é

        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–ª–∞–≥, —á—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏–∫–∞ –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –ò —Ç–∞–π–º–µ—Ä –∞–∫—Ç–∏–≤–µ–Ω
        global.__CORRIDOR_AUTO_TEMP_ENABLED = false;
        global.__AUTO_MODE_PAUSED_BY_MANUAL_CHANGE_TEMP = true; // <-- –ù–æ–≤—ã–π —Ñ–ª–∞–≥ –¥–ª—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã
        global.__MANUAL_CHANGE_TIMER_ACTIVE_TEMP = true; // <-- –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –≤ true
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
        ps_temp["enabled"] = global.__CORRIDOR_AUTO_TEMP_ENABLED;
        ps_temp["paused_by_manual"] = global.__AUTO_MODE_PAUSED_BY_MANUAL_CHANGE_TEMP; // <-- –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–ª–∞–≥
        log("‚è∏Ô∏è –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–æ–π –∫–æ—Ä–∏–¥–æ—Ä–∞ –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –≤—Ä—É—á–Ω—É—é. –¢–∞–π–º–µ—Ä –∞–∫—Ç–∏–≤–µ–Ω.");

        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–æ–≤—ã–π —Ç–∞–π–º–µ—Ä –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –∫ –∞–≤—Ç–æ–º–∞—Ç–∏–∫–µ
        global.__MANUAL_CHANGE_TIMEOUT_ID_TEMP = setTimeout(function() { // –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–æ–≤—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é
            log("‚è∞ –¢–∞–π–º–µ—Ä {} –º–∏–Ω—É—Ç –∏—Å—Ç–µ–∫. –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–æ–π –∫–æ—Ä–∏–¥–æ—Ä–∞.", timeoutMinutes);
            global.__CORRIDOR_AUTO_TEMP_ENABLED = true;
            global.__AUTO_MODE_PAUSED_BY_MANUAL_CHANGE_TEMP = false; // <-- –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥
            global.__MANUAL_CHANGE_TIMER_ACTIVE_TEMP = false; // <-- –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –≤ false
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
            ps_temp["enabled"] = global.__CORRIDOR_AUTO_TEMP_ENABLED;
            ps_temp["paused_by_manual"] = global.__AUTO_MODE_PAUSED_BY_MANUAL_CHANGE_TEMP; // <-- –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–ª–∞–≥
            log("üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–æ–π –∫–æ—Ä–∏–¥–æ—Ä–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ. –°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ.");

            // –ü–æ—Å–ª–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏–∫–∏ ‚Äî –ø—Ä–∏–º–µ–Ω—è–µ–º *–æ–∂–∏–¥–∞–µ–º–æ–µ* –∑–Ω–∞—á–µ–Ω–∏–µ, –µ—Å–ª–∏ –æ–Ω–æ –µ—Å—Ç—å
            applyExpectedTemperature();

            // global.__MANUAL_CHANGE_TIMEOUT_ID_TEMP = null; // –£–∂–µ —Å–±—Ä–æ—à–µ–Ω –≤ clearManualChangeTimeoutTemp
            clearManualChangeTimeoutTemp(); // –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º, —á—Ç–æ ID —Ç–∞–π–º–µ—Ä–∞ —Å–±—Ä–æ—à–µ–Ω –∏ —Ñ–ª–∞–≥ —Ç–æ–∂–µ
        }, timeoutMinutes * 60 * 1000); // –ü–µ—Ä–µ–≤–æ–¥–∏–º –º–∏–Ω—É—Ç—ã –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥—ã

        log("‚è∞ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —Ç–∞–π–º–µ—Ä –Ω–∞ {} –º–∏–Ω—É—Ç –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–æ–π.", timeoutMinutes);
    } finally {
        // –í—Å–µ–≥–¥–∞ —Ä–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º, –¥–∞–∂–µ –µ—Å–ª–∏ –±—ã–ª–∞ –æ—à–∏–±–∫–∞
        global.__CORRIDOR_AUTO_TEMP_LOCK = false;
    }
}


// === –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –æ–∂–∏–¥–∞–µ–º–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã (–æ–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–ª—è –ø–ª–∞–≤–Ω–æ—Å—Ç–∏) ===
function applyExpectedTemperature() {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤–∫–ª—é—á–µ–Ω–∞ –ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∫–∞
    if (!global.__CORRIDOR_AUTO_TEMP_ENABLED) {
        log("üîÑ applyExpectedTemperature: –∞–≤—Ç–æ–º–∞—Ç–∏–∫–∞ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã –æ—Ç–∫–ª—é—á–µ–Ω–∞, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º —É—Å—Ç–∞–Ω–æ–≤–∫—É.");
        return;
    }

    // --- –ù–û–í–û–ï: –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∞–∫—Ç–∏–≤–µ–Ω –ª–∏ —Ç–∞–π–º–µ—Ä —Ä—É—á–Ω–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è ---
    if (global.__MANUAL_CHANGE_TIMER_ACTIVE_TEMP) {
        log("‚ö†Ô∏è applyExpectedTemperature: —Ç–∞–π–º–µ—Ä —Ä—É—á–Ω–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã –µ—â—ë –∞–∫—Ç–∏–≤–µ–Ω, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º —É—Å—Ç–∞–Ω–æ–≤–∫—É.");
        return; // <-- –í–ê–ñ–ù–û: –≤—ã—Ö–æ–¥–∏–º –∏–∑ —Ñ—É–Ω–∫—Ü–∏–∏
    }
    // --------------------------------------------------------------

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∑–∞–ø—É—â–µ–Ω –ª–∏ —É–∂–µ –ø–ª–∞–≤–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥
    if (global.__GRADUAL_TRANSITION_ACTIVE_TEMP) {
        log("‚ö†Ô∏è applyExpectedTemperature: –ø–ª–∞–≤–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã —É–∂–µ –∞–∫—Ç–∏–≤–µ–Ω, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º —É—Å—Ç–∞–Ω–æ–≤–∫—É.");
        return; // <-- –í–ê–ñ–ù–û: –≤—ã—Ö–æ–¥–∏–º –∏–∑ —Ñ—É–Ω–∫—Ü–∏–∏, —á—Ç–æ–±—ã –Ω–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—Ç—å
    }

    var now = new Date();
    var hour = now.getHours();

    // –ü—Ä–∏–º–µ–Ω—è–µ–º –æ–∂–∏–¥–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è CCT1 –∏ CCT2 (–ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º, —á—Ç–æ –æ–Ω–æ –æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ –¥–ª—è –≤—Ä–µ–º–µ–Ω–∏ —Å—É—Ç–æ–∫)
    var targetTemp;
    if (hour >= 8 && hour < 17) {
        targetTemp = 0;
        log("üîÑ applyExpectedTemperature: —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è ({}:{}) –ø–æ–ø–∞–¥–∞–µ—Ç –≤ –¥–Ω–µ–≤–Ω–æ–π –ø–µ—Ä–∏–æ–¥ (8:00-17:00). –¶–µ–ª–µ–≤–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: {}", hour, now.getMinutes(), targetTemp);
    } else if (hour >= 17 && hour < 22) {
        targetTemp = 50;
        log("üîÑ applyExpectedTemperature: —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è ({}:{}) –ø–æ–ø–∞–¥–∞–µ—Ç –≤ –≤–µ—á–µ—Ä–Ω–∏–π –ø–µ—Ä–∏–æ–¥ (17:00-22:00). –¶–µ–ª–µ–≤–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: {}", hour, now.getMinutes(), targetTemp);
    } else {
        targetTemp = 100;
        log("üîÑ applyExpectedTemperature: —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è ({}:{}) –ø–æ–ø–∞–¥–∞–µ—Ç –≤ –Ω–æ—á–Ω–æ–π –ø–µ—Ä–∏–æ–¥ (22:00-8:00). –¶–µ–ª–µ–≤–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: {}", hour, now.getMinutes(), targetTemp);
    }

    log("üîÑ applyExpectedTemperature: –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É –Ω–∞ {} (–æ–∂–∏–¥–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ —Å—É—Ç–æ–∫).", targetTemp);

    // --- –ü—Ä–∏–º–µ–Ω—è–µ–º –ø–ª–∞–≤–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ ---
    setGradualTemperatureChannels(targetTemp);
    // ---------------------------------
}

// === –ü—Ä–∞–≤–∏–ª–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã ===
defineRule("ManualChangeTracker_CCT1_Temp", {
    whenChanged: "wb-led_56/CCT1 Temperature",
    then: function (newValue, devName, cellName) {
        log("‚ö†Ô∏è –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –∫–∞–Ω–∞–ª–∞ '{}' –∏–∑–º–µ–Ω–µ–Ω–∞ –≤—Ä—É—á–Ω—É—é –Ω–∞ {}", cellName, newValue);
        // –û—Ç–∫–ª—é—á–∞–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏–∫—É –Ω–∞ 1 –º–∏–Ω—É—Ç—É
        disableCorridorAutoTemp(30); // –í—ã–∑–æ–≤ –æ–±–Ω–æ–≤–ª—ë–Ω–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
    }
});

defineRule("ManualChangeTracker_CCT2_Temp", {
    whenChanged: "wb-led_56/CCT2 Temperature",
    then: function (newValue, devName, cellName) {
        log("‚ö†Ô∏è –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –∫–∞–Ω–∞–ª–∞ '{}' –∏–∑–º–µ–Ω–µ–Ω–∞ –≤—Ä—É—á–Ω—É—é –Ω–∞ {}", cellName, newValue);
        // –û—Ç–∫–ª—é—á–∞–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏–∫—É –Ω–∞ 1 –º–∏–Ω—É—Ç—É
        disableCorridorAutoTemp(30); // –í—ã–∑–æ–≤ –æ–±–Ω–æ–≤–ª—ë–Ω–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
    }
});

// === –ü—Ä–∞–≤–∏–ª–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–æ–π (—Ç–µ–ø–µ—Ä—å —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Ñ–ª–∞–≥–∞ –∏ –æ–±–Ω–æ–≤–ª—ë–Ω–Ω–æ–π –ª–æ–≥–∏–∫–æ–π) ===
// –ü—Ä–∞–≤–∏–ª–æ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è wb-led_56/CCT1 Temperature
defineRule("Corridor_CCT1_Temp_8AM", {
    when: cron("0 8 * * *"), // –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 08:00
    then: function() {
        if (global.__CORRIDOR_AUTO_TEMP_ENABLED && !global.__MANUAL_CHANGE_TIMER_ACTIVE_TEMP) { // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–ª–∞–≥ —Ç–∞–π–º–µ—Ä–∞
            log("‚úÖ –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ CCT1: –∞–≤—Ç–æ–º–∞—Ç–∏–∫–∞ –≤–∫–ª—é—á–µ–Ω–∞, —Ç–∞–π–º–µ—Ä –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω. –ü—Ä–∏–º–µ–Ω—è–µ–º –æ–∂–∏–¥–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ.");
            applyExpectedTemperature(); // –í—ã–∑–æ–≤ –æ–±–Ω–æ–≤–ª—ë–Ω–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
        } else {
            log("‚è≠Ô∏è –ü—Ä–æ–ø—É—Å–∫ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã CCT1 –Ω–∞ 0 (08:00) - –∞–≤—Ç–æ–º–∞—Ç–∏–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∞ –∏–ª–∏ —Ç–∞–π–º–µ—Ä –∞–∫—Ç–∏–≤–µ–Ω.");
        }
    }
});

defineRule("Corridor_CCT1_Temp_5PM", {
    when: cron("0 17 * * *"), // –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 17:00
    then: function() {
        if (global.__CORRIDOR_AUTO_TEMP_ENABLED && !global.__MANUAL_CHANGE_TIMER_ACTIVE_TEMP) { // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–ª–∞–≥ —Ç–∞–π–º–µ—Ä–∞
            log("‚úÖ –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ CCT1: –∞–≤—Ç–æ–º–∞—Ç–∏–∫–∞ –≤–∫–ª—é—á–µ–Ω–∞, —Ç–∞–π–º–µ—Ä –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω. –ü—Ä–∏–º–µ–Ω—è–µ–º –æ–∂–∏–¥–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ.");
            applyExpectedTemperature(); // –í—ã–∑–æ–≤ –æ–±–Ω–æ–≤–ª—ë–Ω–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
        } else {
            log("‚è≠Ô∏è –ü—Ä–æ–ø—É—Å–∫ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã CCT1 –Ω–∞ 50 (17:00) - –∞–≤—Ç–æ–º–∞—Ç–∏–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∞ –∏–ª–∏ —Ç–∞–π–º–µ—Ä –∞–∫—Ç–∏–≤–µ–Ω.");
        }
    }
});

defineRule("Corridor_CCT1_Temp_10PM", {
    when: cron("0 22 * * *"), // –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 22:00
    then: function() {
        if (global.__CORRIDOR_AUTO_TEMP_ENABLED && !global.__MANUAL_CHANGE_TIMER_ACTIVE_TEMP) { // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–ª–∞–≥ —Ç–∞–π–º–µ—Ä–∞
            log("‚úÖ –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ CCT1: –∞–≤—Ç–æ–º–∞—Ç–∏–∫–∞ –≤–∫–ª—é—á–µ–Ω–∞, —Ç–∞–π–º–µ—Ä –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω. –ü—Ä–∏–º–µ–Ω—è–µ–º –æ–∂–∏–¥–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ.");
            applyExpectedTemperature(); // –í—ã–∑–æ–≤ –æ–±–Ω–æ–≤–ª—ë–Ω–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
        } else {
            log("‚è≠Ô∏è –ü—Ä–æ–ø—É—Å–∫ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã CCT1 –Ω–∞ 100 (22:00) - –∞–≤—Ç–æ–º–∞—Ç–∏–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∞ –∏–ª–∏ —Ç–∞–π–º–µ—Ä –∞–∫—Ç–∏–≤–µ–Ω.");
        }
    }
});

// –ü—Ä–∞–≤–∏–ª–æ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è wb-led_56/CCT2 Temperature (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ CCT1)
defineRule("Corridor_CCT2_Temp_8AM", {
    when: cron("0 8 * * *"), // –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 08:00
    then: function() {
        if (global.__CORRIDOR_AUTO_TEMP_ENABLED && !global.__MANUAL_CHANGE_TIMER_ACTIVE_TEMP) { // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–ª–∞–≥ —Ç–∞–π–º–µ—Ä–∞
            log("‚úÖ –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ CCT2: –∞–≤—Ç–æ–º–∞—Ç–∏–∫–∞ –≤–∫–ª—é—á–µ–Ω–∞, —Ç–∞–π–º–µ—Ä –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω. –ü—Ä–∏–º–µ–Ω—è–µ–º –æ–∂–∏–¥–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ.");
            applyExpectedTemperature(); // –í—ã–∑–æ–≤ –æ–±–Ω–æ–≤–ª—ë–Ω–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
        } else {
            log("‚è≠Ô∏è –ü—Ä–æ–ø—É—Å–∫ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã CCT2 –Ω–∞ 0 (08:00) - –∞–≤—Ç–æ–º–∞—Ç–∏–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∞ –∏–ª–∏ —Ç–∞–π–º–µ—Ä –∞–∫—Ç–∏–≤–µ–Ω.");
        }
    }
});

defineRule("Corridor_CCT2_Temp_5PM", {
    when: cron("0 17 * * *"), // –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 17:00
    then: function() {
        if (global.__CORRIDOR_AUTO_TEMP_ENABLED && !global.__MANUAL_CHANGE_TIMER_ACTIVE_TEMP) { // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–ª–∞–≥ —Ç–∞–π–º–µ—Ä–∞
            log("‚úÖ –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ CCT2: –∞–≤—Ç–æ–º–∞—Ç–∏–∫–∞ –≤–∫–ª—é—á–µ–Ω–∞, —Ç–∞–π–º–µ—Ä –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω. –ü—Ä–∏–º–µ–Ω—è–µ–º –æ–∂–∏–¥–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ.");
            applyExpectedTemperature(); // –í—ã–∑–æ–≤ –æ–±–Ω–æ–≤–ª—ë–Ω–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
        } else {
            log("‚è≠Ô∏è –ü—Ä–æ–ø—É—Å–∫ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã CCT2 –Ω–∞ 50 (17:00) - –∞–≤—Ç–æ–º–∞—Ç–∏–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∞ –∏–ª–∏ —Ç–∞–π–º–µ—Ä –∞–∫—Ç–∏–≤–µ–Ω.");
        }
    }
});

defineRule("Corridor_CCT2_Temp_10PM", {
    when: cron("0 22 * * *"), // –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 22:00
    then: function() {
        if (global.__CORRIDOR_AUTO_TEMP_ENABLED && !global.__MANUAL_CHANGE_TIMER_ACTIVE_TEMP) { // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–ª–∞–≥ —Ç–∞–π–º–µ—Ä–∞
            log("‚úÖ –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ CCT2: –∞–≤—Ç–æ–º–∞—Ç–∏–∫–∞ –≤–∫–ª—é—á–µ–Ω–∞, —Ç–∞–π–º–µ—Ä –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω. –ü—Ä–∏–º–µ–Ω—è–µ–º –æ–∂–∏–¥–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ.");
            applyExpectedTemperature(); // –í—ã–∑–æ–≤ –æ–±–Ω–æ–≤–ª—ë–Ω–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
        } else {
            log("‚è≠Ô∏è –ü—Ä–æ–ø—É—Å–∫ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã CCT2 –Ω–∞ 100 (22:00) - –∞–≤—Ç–æ–º–∞—Ç–∏–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∞ –∏–ª–∏ —Ç–∞–π–º–µ—Ä –∞–∫—Ç–∏–≤–µ–Ω.");
        }
    }
});

// === –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –¥–ª—è –æ—Ç–∫–ª—é—á–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) ===
// –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ
var autoCorridorTempDevice = getDevice("auto_corridor_temp_control");

if (!autoCorridorTempDevice) {
    // –ï—Å–ª–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç ‚Äî —Å–æ–∑–¥–∞—ë–º –µ–≥–æ
    defineVirtualDevice('auto_corridor_temp_control', {
        title: { en: 'Auto Corridor Temp Control', ru: '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–æ–π —Å–≤–µ—Ç–æ–≤—ã—Ö –ª–∏–Ω–∏–π' },
        cells: {
            auto_mode: {
                title: { en: 'Auto Mode', ru: '–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∂–∏–º' },
                type: "switch",
                value: true, // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤–∫–ª—é—á–µ–Ω (—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç true –¥–ª—è —Ñ–ª–∞–≥–∞)
                //description: "–í–∫–ª—é—á–∏—Ç—å/–æ—Ç–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–æ–π –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é"
            }
        }
    });
    log("‚úÖ –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ 'auto_corridor_temp_control' —Å–æ–∑–¥–∞–Ω–æ.");
} else {
    log("‚ÑπÔ∏è –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ 'auto_corridor_temp_control' —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.");
}

// –ü—Ä–∞–≤–∏–ª–æ: —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è auto_mode
// –≠—Ç–æ –ø—Ä–∞–≤–∏–ª–æ —É–ø—Ä–∞–≤–ª—è–µ—Ç –≥–ª–æ–±–∞–ª—å–Ω—ã–º —Ñ–ª–∞–≥–æ–º, –Ω–æ –æ–Ω–æ –Ω–µ –±—É–¥–µ—Ç —Å–±—Ä–∞—Å—ã–≤–∞—Ç—å —Ç–∞–π–º–µ—Ä,
// —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –ø—Ä–∏ —Ä—É—á–Ω–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏. –û–Ω–æ –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–∫—Ä—ã–≤–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏–∫—É.
// --- –ò–ó–ú–ï–ù–ï–ù–û: —Ç–µ–ø–µ—Ä—å –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∏ —Ñ–ª–∞–≥ —Ç–∞–π–º–µ—Ä–∞ ---
defineRule('AutoModeToggleRule_CorridorTemp', {
    whenChanged: "auto_corridor_temp_control/auto_mode",
    then: function (newValue, devName, cellName) {
        global.__CORRIDOR_AUTO_TEMP_ENABLED = newValue;
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
        ps_temp["enabled"] = global.__CORRIDOR_AUTO_TEMP_ENABLED;

        if (newValue) {
            log("‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∂–∏–º —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã –∫–æ—Ä–∏–¥–æ—Ä–∞ –≤–∫–ª—é—á–µ–Ω —á–µ—Ä–µ–∑ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ.");
            // –û—á–∏—â–∞–µ–º —Ç–∞–π–º–µ—Ä, –µ—Å–ª–∏ –æ–Ω –±—ã–ª, —Ç–∞–∫ –∫–∞–∫ –≤–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–æ—à–ª–æ –≤—Ä—É—á–Ω—É—é
            if (global.__MANUAL_CHANGE_TIMEOUT_ID_TEMP) { // –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–æ–≤—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é
                clearTimeout(global.__MANUAL_CHANGE_TIMEOUT_ID_TEMP); // –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–æ–≤—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é
                global.__MANUAL_CHANGE_TIMEOUT_ID_TEMP = null; // –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–æ–≤—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é
                global.__MANUAL_CHANGE_TIMER_ACTIVE_TEMP = false; // –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–æ–≤—ã–π —Ñ–ª–∞–≥
            }
            // –¢–∞–∫–∂–µ —Å–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥ —Ä—É—á–Ω–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è, –µ—Å–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∫–∞ –≤–∫–ª—é—á–µ–Ω–∞ –≤—Ä—É—á–Ω—É—é
            global.__AUTO_MODE_PAUSED_BY_MANUAL_CHANGE_TEMP = false; // <-- –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥ –ø—Ä–∏ –≤–∫–ª—é—á–µ–Ω–∏–∏
            ps_temp["paused_by_manual"] = global.__AUTO_MODE_PAUSED_BY_MANUAL_CHANGE_TEMP; // <-- –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–ª–∞–≥
            log("üîÑ –§–ª–∞–≥ —Ä—É—á–Ω–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã —Å–±—Ä–æ—à–µ–Ω –ø—Ä–∏ –≤–∫–ª—é—á–µ–Ω–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∫–∏.");
        } else {
            log("‚ùå –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∂–∏–º —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã –∫–æ—Ä–∏–¥–æ—Ä–∞ –æ—Ç–∫–ª—é—á–µ–Ω —á–µ—Ä–µ–∑ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ.");
            // –ù–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∞–π–º–µ—Ä, –ø—Ä–æ—Å—Ç–æ –æ—Ç–∫–ª—é—á–∞–µ–º.
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥ —Ä—É—á–Ω–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è, –µ—Å–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∞ –≤—Ä—É—á–Ω—É—é
            global.__AUTO_MODE_PAUSED_BY_MANUAL_CHANGE_TEMP = false; // <-- –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥ –ø—Ä–∏ –æ—Ç–∫–ª—é—á–µ–Ω–∏–∏
            ps_temp["paused_by_manual"] = global.__AUTO_MODE_PAUSED_BY_MANUAL_CHANGE_TEMP; // <-- –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–ª–∞–≥
            log("üîÑ –§–ª–∞–≥ —Ä—É—á–Ω–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã —Å–±—Ä–æ—à–µ–Ω –ø—Ä–∏ –æ—Ç–∫–ª—é—á–µ–Ω–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∫–∏.");
        }
    }
});

// === –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è: —É–±–µ–¥–∏–º—Å—è, —á—Ç–æ —Ñ–ª–∞–≥ –∏ –æ–∂–∏–¥–∞–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—é –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ ===
defineRule("InitCorridorTempControl", {
    when: function() { return true; }, // –°—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
    then: function() {
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞, –µ—Å–ª–∏ –æ–Ω–æ –µ—Å—Ç—å, –∏–Ω–∞—á–µ true
        var initialMode = ps_temp["enabled"];
        var initialPaused = ps_temp["paused_by_manual"]; // <-- –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–ª–∞–≥ —Ä—É—á–Ω–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è

        if (initialMode === undefined) {
            // –ï—Å–ª–∏ –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –Ω–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è, –ø—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å –∏–∑ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
            var deviceValue = dev["auto_corridor_temp_control/auto_mode"];
            if (deviceValue !== undefined) {
                global.__CORRIDOR_AUTO_TEMP_ENABLED = deviceValue;
                log("üîÑ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∂–∏–º —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã –∫–æ—Ä–∏–¥–æ—Ä–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏–∑ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –Ω–∞ {}", global.__CORRIDOR_AUTO_TEMP_ENABLED);
            } else {
                global.__CORRIDOR_AUTO_TEMP_ENABLED = true; // –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                log("üîÑ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∂–∏–º —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã –∫–æ—Ä–∏–¥–æ—Ä–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –Ω–∞ {}", global.__CORRIDOR_AUTO_TEMP_ENABLED);
            }
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
            ps_temp["enabled"] = global.__CORRIDOR_AUTO_TEMP_ENABLED;
        } else {
            global.__CORRIDOR_AUTO_TEMP_ENABLED = initialMode;
            log("üîÑ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∂–∏–º —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã –∫–æ—Ä–∏–¥–æ—Ä–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏–∑ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –Ω–∞ {}", global.__CORRIDOR_AUTO_TEMP_ENABLED);
        }

        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–ª–∞–≥ —Ä—É—á–Ω–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è
        global.__AUTO_MODE_PAUSED_BY_MANUAL_CHANGE_TEMP = initialPaused || false; // <-- –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–ª–∞–≥
        global.__MANUAL_CHANGE_TIMER_ACTIVE_TEMP = false; // <-- –ü—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Ç–∞–π–º–µ—Ä –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω
        log("üîÑ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è: —Ñ–ª–∞–≥ —Ä—É—á–Ω–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏–∑ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –∫–∞–∫ {}, —Ç–∞–π–º–µ—Ä –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω.", global.__AUTO_MODE_PAUSED_BY_MANUAL_CHANGE_TEMP);

        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–∂–∏–¥–∞–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è (–µ—Å–ª–∏ –æ–Ω–∏ –Ω—É–∂–Ω—ã –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏)
        var initialExpectedCCT1 = ps_temp["expected_cct1_temp"];
        var initialExpectedCCT2 = ps_temp["expected_cct2_temp"];

        if (initialExpectedCCT1 !== undefined) {
            global.__CORRIDOR_EXPECTED_CCT1_TEMP = initialExpectedCCT1;
            log("üîÑ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è: –æ–∂–∏–¥–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ CCT1 –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –∏–∑ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞: {}", global.__CORRIDOR_EXPECTED_CCT1_TEMP);
        } else {
            log("üîÑ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è: –æ–∂–∏–¥–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ CCT1 –Ω–µ –Ω–∞–π–¥–µ–Ω–æ, –±—É–¥–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é.");
        }

        if (initialExpectedCCT2 !== undefined) {
            global.__CORRIDOR_EXPECTED_CCT2_TEMP = initialExpectedCCT2;
            log("üîÑ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è: –æ–∂–∏–¥–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ CCT2 –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –∏–∑ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞: {}", global.__CORRIDOR_EXPECTED_CCT2_TEMP);
        } else {
            log("üîÑ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è: –æ–∂–∏–¥–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ CCT2 –Ω–µ –Ω–∞–π–¥–µ–Ω–æ, –±—É–¥–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é.");
        }
    }
});